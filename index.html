<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <title>ê²ŒìŠ¤íŠ¸ ì „ìš© ì…ì¥ GIF ìƒì„±ê¸°</title>
    <style>
      body {
        font-family: sans-serif;
        text-align: center;
        background: #f2f2f2;
        padding: 20px;
      }
      h1 {
        font-size: 24px;
      }
      form input,
      form button {
        margin: 6px;
        padding: 10px;
        font-size: 16px;
      }
      canvas {
        margin-top: 20px;
        border: 2px solid #333;
        background: #000;
      }
      #downloadLink {
        display: none;
        margin-top: 10px;
        font-size: 18px;
        text-decoration: none;
        color: #0066cc;
      }
    </style>
  </head>
  <body>
    <h1>ê²ŒìŠ¤íŠ¸ ì „ìš© ì…ì¥ GIF ìƒì„±ê¸°</h1>
    <form id="gifForm">
      <input type="text" id="showName" placeholder="ê³µì—°ëª…" required />
      <input type="text" id="guestName" placeholder="ê²ŒìŠ¤íŠ¸ ì´ë¦„" required />
      <input type="date" id="date" required />
      <button type="submit">GIF ìƒì„±</button>
    </form>

    <canvas id="previewCanvas" width="400" height="300"></canvas>
    <br />
    <a id="downloadLink" download="guest-pass.gif">ğŸ ìƒì„±ëœ GIF ë‹¤ìš´ë¡œë“œ</a>

    <!-- gif.js ë¼ì´ë¸ŒëŸ¬ë¦¬ ë‚´ì¥ -->
    <script>
      /*! gif.js - MIT License - https://github.com/jnordberg/gif.js */
      // (ìƒëµ ì—†ì´ gif.js ì „ì²´ë¥¼ ì—¬ê¸°ì— ë„£ì–´ì•¼ í•©ë‹ˆë‹¤. ë¶€í”¼ê°€ ì»¤ì„œ í•„ìš”ì‹œ ë§í¬ ì œê³µ ê°€ëŠ¥)
      // ğŸ‘‰ ëŒ€ì‹  CDNìœ¼ë¡œ ì—°ê²°:
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gif.js/0.2.0/gif.js"></script>
    <script>
      // gif.worker.js ê²½ë¡œ ì„¤ì • (í•„ìˆ˜)
      GIF.prototype.workerScript =
        "https://cdnjs.cloudflare.com/ajax/libs/gif.js/0.2.0/gif.worker.js";
    </script>

    <!-- QRCode.js ë‚´ì¥ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

    <!-- ë©”ì¸ ìŠ¤í¬ë¦½íŠ¸ -->
    <script>
      window.addEventListener("DOMContentLoaded", () => {
        const canvas = document.getElementById("previewCanvas");
        const ctx = canvas.getContext("2d");
        const form = document.getElementById("gifForm");
        const downloadLink = document.getElementById("downloadLink");

        form.addEventListener("submit", (e) => {
          e.preventDefault();

          const showName = document.getElementById("showName").value;
          const guestName = document.getElementById("guestName").value;
          const date = document.getElementById("date").value;

          const gif = new GIF({
            workers: 2,
            quality: 10,
            width: canvas.width,
            height: canvas.height,
          });

          for (let i = 0; i < 8; i++) {
            drawFrame(ctx, showName, guestName, date, i);
            gif.addFrame(ctx, { copy: true, delay: 200 });
          }

          gif.on("finished", (blob) => {
            const url = URL.createObjectURL(blob);
            downloadLink.href = url;
            downloadLink.style.display = "inline";
          });

          gif.render();
        });

        function drawFrame(ctx, showName, guestName, date, frameIndex) {
          ctx.clearRect(0, 0, canvas.width, canvas.height);
          ctx.fillStyle = "#111";
          ctx.fillRect(0, 0, canvas.width, canvas.height);

          ctx.fillStyle = "#fff";
          ctx.font = "bold 20px sans-serif";
          ctx.fillText(`ğŸ¤ ${showName}`, 20, 50);
          ctx.fillText(`ğŸŸï¸ ${guestName}`, 20, 90);
          ctx.fillText(`ğŸ“… ${date}`, 20, 130);

          // ì• ë‹ˆë©”ì´ì…˜ìš© ì»¬ëŸ¬ ì›
          ctx.fillStyle = `hsl(${frameIndex * 45}, 100%, 50%)`;
          ctx.beginPath();
          ctx.arc(300, 220, 20 + (frameIndex % 3) * 2, 0, Math.PI * 2);
          ctx.fill();

          // QR ì½”ë“œ ìƒì„±
          const qrCanvas = document.createElement("canvas");
          new QRCode(qrCanvas, {
            text: `${guestName}-${date}-${showName}`,
            width: 80,
            height: 80,
          });
          ctx.drawImage(qrCanvas, 300, 20);
        }
      });
    </script>
  </body>
</html>
